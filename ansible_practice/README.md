# Практикум по Ansible:

Выполнение практического задания:

Локально запущена контролнода на Ubuntu через Vagrant, удалённая вируалка CentOS в Vultr.com.
В связи с EOL Centos7 реп использовал таргетную виртуалку на Centos 9.
Решило проблемы с недоступностью реп для установки пакетов, возможно создало новые проблемы. 
HowToAnsible - моя рабочая шпаргалка, всё локально пишу на VSCode потом пушу мерджи в main бранч.
Практику поздно начал выполнять т.к. был в отпуске, и не сразу понял что есть конечное практическое задание. т.к. не было даже упомянуто в Ансибл курсе, что нужно вернутся в DevOps Upgrade поток и брать задание там. Прошу прощения :)
Сервер облачный потушил т.к. ососбо не защищён, если надо - могу включить и покажу как всё работает. Пока не удаляю.


# Прогресс

- Запуск приложения проходит если верить аутпуту. Вместо упомянутых пакетов ставятся центосные item=gcc libxml2-devel. Были рекурсивные ошибки:

An error occurred while installing nokogiri (1.8.2), and Bundler cannot continue.
Make sure that `gem install nokogiri -v '1.8.2' --source 'https://rubygems.org/'` succeeds before bundling.

In Gemfile:
  rails was resolved to 5.2.0, which depends on
    actioncable was resolved to 5.2.0, which depends on
      actionpack was resolved to 5.2.0, which depends on
        actionview was resolved to 5.2.0, which depends on
          rails-dom-testing was resolved to 2.0.3, which depends on
            nokogiri



- СУБД установлена запущена postgres (PostgreSQL) 13.14
- Веб сервер запущен, nginx/1.20.1 . Но конфиг jinja скопирован, частично избавился от энвов т.к. не получилось их использовать. 
- Энвайронменты запуска приложения берутся из Jinja темплейта. 
- Включается автозапуск в systemd.

# Последний результат:

vagrant@controlnode:~/ansible$ ansible-playbook playbook.yml -i hosts.ini
[WARNING]: Found variable using reserved name: vars_files

PLAY [Application deployment] ***************************************************************************************************************************************************
TASK [Gathering Facts] **********************************************************************************************************************************************************ok: [45.76.95.174]

TASK [nginx : Install Nginx] ****************************************************************************************************************************************************ok: [45.76.95.174]

TASK [nginx : Start and enable Nginx service] ***********************************************************************************************************************************ok: [45.76.95.174]

TASK [nginx : Copy custom nginx configuration] **********************************************************************************************************************************ok: [45.76.95.174]

TASK [postgres : Install PostgreSQL] ********************************************************************************************************************************************ok: [45.76.95.174]

TASK [postgres : Install psycopg2] **********************************************************************************************************************************************ok: [45.76.95.174]

TASK [postgres : Install postgresql-devel] **************************************************************************************************************************************ok: [45.76.95.174]

TASK [postgres : Initialize PostgreSQL database] ********************************************************************************************************************************ok: [45.76.95.174]

TASK [postgres : Ensure PostgreSQL is running and enabled] **********************************************************************************************************************ok: [45.76.95.174]

TASK [postgres : Configure PostgreSQL to allow password authentication] *********************************************************************************************************ok: [45.76.95.174]

TASK [postgres : Restart PostgreSQL to apply configuration changes] *************************************************************************************************************changed: [45.76.95.174]

TASK [postgres : Create database user] ******************************************************************************************************************************************ok: [45.76.95.174]

TASK [postgres : Create database] ***********************************************************************************************************************************************ok: [45.76.95.174]

TASK [dependencies : Install required system packages] **************************************************************************************************************************ok: [45.76.95.174] => (item=gcc)
ok: [45.76.95.174] => (item=libxml2-devel)
ok: [45.76.95.174] => (item=ruby)
ok: [45.76.95.174] => (item=ruby-devel)
ok: [45.76.95.174] => (item=shared-mime-info)

TASK [dependencies : Ensure /home/vagrant/app directory exists] *****************************************************************************************************************ok: [45.76.95.174]

TASK [dependencies : Configure Bundler] *****************************************************************************************************************************************changed: [45.76.95.174]

TASK [dependencies : Create systemd file to autostart application] **************************************************************************************************************ok: [45.76.95.174]

PLAY RECAP **********************************************************************************************************************************************************************45.76.95.174               : ok=17   changed=2    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0